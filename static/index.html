<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>teleNex</title>
    <!-- Bootstrap and JQuery -->
    <script   src="scripts/jquery-2.2.4.min.js"   integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="css/app.css">
    <!-- AngularJS -->
    <script src="scripts/angular.min.js"></script>
    <!-- Plotly.js -->
    <script src="scripts/plotly-latest.min.js"></script>
    <!-- Javascript Files -->
    <script src="scripts/app.js"></script>
    <script src="scripts/auto-emotion.js"></script>
    <!-- Webcam.js JavaScript Library -->
    <script type="text/javascript" src="scripts/webcam.js"></script>
</head>
<body ng-app="teleNex" ng-controller="MainController as MainCtrl">
    <div class="container" id="MainWrap">
        <div class="row">
            <div class="col-xs-12">
                    <div class = "webcam">
        <div id="camera" class="center-block"></div>
             
        <!-- Configure a few settings and attach camera -->
        <script language="JavaScript">
            Webcam.set({
                width: 320,
                height: 240,
                dest_width: 320,
                dest_height: 240,
                image_format: 'jpeg',
                jpeg_quality: 90
            });
            Webcam.attach( '#camera' );
        </script>
        <!-- A button for taking snaps -->
        <form>
            
        </form>

        <form>
            <input type="button" class="btn btn-default center-block text-center" id="record_toggle" onClick="record()" value="Start Recording">
        </form>
        
        <!-- Code to handle taking the snapshot and displaying it locally -->
        <script language="JavaScript">
        var score;
        var numberFrames;
        function initScore () {
            score = 0;
            numberFrames = 0;
        }
     
        var data;
        var weight = [0.3, -0.3, -0.5, -0.4, 0.0];    


            function take_snapshot() {
                console.log("Snapshot function called");
                // take snapshot and get image data
                Webcam.snap( function(data_uri) {

                    // var xhr = new XMLHttpRequest();
                    // xhr.open("POST", "../get_frame_sentiment");
                    // //xhr.setRequestHeader('Content-Type', 'application/json');
                    // //xhr.setRequestHeader("Ocp-Apim-Subscription-Key", "59e8effcb05b4ab5b37dc2e0f3290315");
                    // xhr.send(data_uri);
                    // //if (xhr.readyState == 4)
                    //  // if (xhr.status == 200)
                    //     //var json_response = JSON.parse(xhr.responseText);

                    $.ajax({
                      type: "POST",
                      contentType: "application/json; charset=utf-8",
                      url: "/get_frame_sentiment",
                      data: JSON.stringify({data: data_uri}),
                      success: function (r) {
                        //console.log(r);
                        angular.element(document.getElementById("MainWrap")).scope().plot_points(r); console.log('test ' + r)
                      },
                      dataType: "json"
                    });
                    numberFrames += 1;
                    var i;
                    for (i = 0; i < 6; i++) {
                        score += r[i] * weight[i];
                    }
                    // console.log(xhr.responseText);


                } );
            }

            function record() {
                if (!timer_flag) {
                    initScore();
                    startCount(function () {take_snapshot();});
                    document.getElementById("record_toggle").value="Stop Recording";
                }
                else {
                    stopCount();
                    console.log(score/numberFrames);
                    document.getElementById("record_toggle").value="Start Recording";
                }
            }
        </script>
        </div>

                <h1 class="text-center">teleNex</h1>
                <div id="myDiv" style=""></div>
            </div>
        </div>
        <div class="col-md-12">
            <br><br>
            <!--<button class="btn btn-default center-block text-center" ng-click="randomEntry()">Random Entry</button>-->
        </div>
    </div>

</html>
